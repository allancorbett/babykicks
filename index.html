<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baby Kick Tracker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #fef7f0;
      color: #3d2c2c;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      font-size: 1.6rem;
      margin-bottom: 4px;
      color: #b35a7a;
    }

    .subtitle {
      font-size: 0.85rem;
      color: #999;
      margin-bottom: 24px;
    }

    #kick-btn {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, #f7a8c4, #b35a7a);
      color: #fff;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 24px rgba(179, 90, 122, 0.35);
      transition: transform 0.1s, box-shadow 0.1s;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    #kick-btn:active {
      transform: scale(0.93);
      box-shadow: 0 2px 10px rgba(179, 90, 122, 0.3);
    }

    #kick-btn.flash {
      animation: pop 0.3s ease;
    }

    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    .stats {
      display: flex;
      gap: 24px;
      margin: 20px 0;
      font-size: 0.95rem;
    }

    .stats span {
      background: #fff;
      padding: 8px 16px;
      border-radius: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }

    .stats strong { color: #b35a7a; }

    .section-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 24px 0 8px;
      color: #b35a7a;
      width: 100%;
      max-width: 500px;
    }

    /* Chart */
    .chart-container {
      width: 100%;
      max-width: 500px;
      background: #fff;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      margin-bottom: 8px;
    }

    canvas {
      width: 100% !important;
      height: 200px !important;
    }

    /* Kick log */
    .log-container {
      width: 100%;
      max-width: 500px;
      background: #fff;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      margin-bottom: 16px;
      max-height: 340px;
      overflow-y: auto;
    }

    .day-group { margin-bottom: 14px; }

    .day-label {
      font-weight: 600;
      font-size: 0.85rem;
      color: #b35a7a;
      margin-bottom: 4px;
      position: sticky;
      top: 0;
      background: #fff;
      padding: 2px 0;
    }

    .kick-entry {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
      font-size: 0.85rem;
      border-bottom: 1px solid #f5eeee;
    }

    .kick-entry:last-child { border-bottom: none; }

    .kick-time { color: #555; }

    .delete-btn {
      background: none;
      border: none;
      color: #ccc;
      cursor: pointer;
      font-size: 1rem;
      padding: 0 4px;
      line-height: 1;
    }

    .delete-btn:hover { color: #e55; }

    /* Actions */
    .actions {
      display: flex;
      gap: 10px;
      margin: 8px 0 16px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .actions button {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid #ddd;
      background: #fff;
      color: #555;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .actions button:hover { background: #fef0f5; border-color: #b35a7a; color: #b35a7a; }

    /* Past kick modal */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      z-index: 10;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open { display: flex; }

    .modal {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 320px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      text-align: center;
    }

    .modal h2 {
      font-size: 1.1rem;
      color: #b35a7a;
      margin-bottom: 16px;
    }

    .modal label {
      display: block;
      text-align: left;
      font-size: 0.8rem;
      color: #777;
      margin: 10px 0 4px;
    }

    .modal input[type="date"],
    .modal input[type="time"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      color: #3d2c2c;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }

    .modal-actions button {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .modal-actions .save-btn {
      background: linear-gradient(135deg, #f7a8c4, #b35a7a);
      color: #fff;
      border: none;
      font-weight: 600;
    }

    .modal-actions .cancel-btn {
      background: #fff;
      color: #555;
    }

    .empty-msg {
      text-align: center;
      color: #bbb;
      font-size: 0.85rem;
      padding: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Baby Kicks</h1>
  <p class="subtitle">Tap the button each time you feel a kick</p>

  <button id="kick-btn">Record Kick</button>

  <div class="stats">
    <span>Today: <strong id="today-count">0</strong></span>
    <span>Total: <strong id="total-count">0</strong></span>
  </div>

  <div class="actions">
    <button onclick="exportCSV()">Export CSV</button>
    <button onclick="document.getElementById('import-file').click()">Import CSV</button>
    <input type="file" id="import-file" accept=".csv" style="display:none" onchange="importCSV(event)">
    <button onclick="openPastKick()">Add Past Kick</button>
    <button onclick="clearAll()">Clear All</button>
  </div>

  <div class="modal-overlay" id="past-modal">
    <div class="modal">
      <h2>Add Past Kick</h2>
      <label for="past-date">Date</label>
      <input type="date" id="past-date">
      <label for="past-time">Time</label>
      <input type="time" id="past-time" step="1">
      <div class="modal-actions">
        <button class="cancel-btn" onclick="closePastKick()">Cancel</button>
        <button class="save-btn" onclick="savePastKick()">Save</button>
      </div>
    </div>
  </div>

  <div class="section-title">Kicks per Day</div>
  <div class="chart-container">
    <canvas id="chart"></canvas>
  </div>

  <div class="section-title">Kick Log</div>
  <div class="log-container" id="log"></div>

  <script>
    const STORAGE_KEY = 'babykicks';

    function getKicks() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
      } catch {
        return [];
      }
    }

    function saveKicks(kicks) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(kicks));
    }

    function formatDate(iso) {
      const d = new Date(iso);
      return d.toLocaleDateString(undefined, { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
    }

    function formatTime(iso) {
      return new Date(iso).toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }

    function dateKey(iso) {
      const d = new Date(iso);
      return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    }

    function todayKey() {
      return dateKey(new Date().toISOString());
    }

    // Record kick
    const btn = document.getElementById('kick-btn');
    btn.addEventListener('click', () => {
      const kicks = getKicks();
      kicks.push(new Date().toISOString());
      saveKicks(kicks);
      btn.classList.remove('flash');
      void btn.offsetWidth;
      btn.classList.add('flash');
      render();
    });

    // Delete a kick
    function deleteKick(index) {
      const kicks = getKicks();
      kicks.splice(index, 1);
      saveKicks(kicks);
      render();
    }

    // Export CSV
    function exportCSV() {
      const kicks = getKicks();
      if (!kicks.length) return;
      const rows = ['date,time,iso'];
      kicks.forEach(iso => {
        rows.push(`${dateKey(iso)},${formatTime(iso)},${iso}`);
      });
      const blob = new Blob([rows.join('\n')], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `babykicks-${todayKey()}.csv`;
      a.click();
    }

    // Import CSV
    function importCSV(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        const lines = ev.target.result.split('\n').slice(1);
        const kicks = getKicks();
        let added = 0;
        const existing = new Set(kicks);
        lines.forEach(line => {
          const parts = line.split(',');
          const iso = (parts[2] || '').trim();
          if (iso && !existing.has(iso)) {
            kicks.push(iso);
            existing.add(iso);
            added++;
          }
        });
        kicks.sort();
        saveKicks(kicks);
        render();
        alert(`Imported ${added} new kick(s).`);
      };
      reader.readAsText(file);
      e.target.value = '';
    }

    // Clear all
    function clearAll() {
      if (confirm('Delete all recorded kicks?')) {
        saveKicks([]);
        render();
      }
    }

    // Render everything
    function render() {
      const kicks = getKicks();

      // Stats
      const today = todayKey();
      const todayCount = kicks.filter(k => dateKey(k) === today).length;
      document.getElementById('today-count').textContent = todayCount;
      document.getElementById('total-count').textContent = kicks.length;

      // Log grouped by day (newest first)
      const log = document.getElementById('log');
      if (!kicks.length) {
        log.innerHTML = '<div class="empty-msg">No kicks recorded yet</div>';
      } else {
        const grouped = {};
        kicks.forEach((iso, i) => {
          const dk = dateKey(iso);
          if (!grouped[dk]) grouped[dk] = [];
          grouped[dk].push({ iso, index: i });
        });

        const days = Object.keys(grouped).sort().reverse();
        let html = '';
        days.forEach(day => {
          const entries = grouped[day].sort((a, b) => b.iso.localeCompare(a.iso));
          html += `<div class="day-group"><div class="day-label">${formatDate(entries[0].iso)} (${entries.length})</div>`;
          entries.forEach(e => {
            html += `<div class="kick-entry"><span class="kick-time">${formatTime(e.iso)}</span><button class="delete-btn" onclick="deleteKick(${e.index})" title="Delete">&times;</button></div>`;
          });
          html += '</div>';
        });
        log.innerHTML = html;
      }

      drawChart(kicks);
    }

    // Bar chart (no dependencies)
    function drawChart(kicks) {
      const canvas = document.getElementById('chart');
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);
      const W = rect.width;
      const H = rect.height;

      ctx.clearRect(0, 0, W, H);

      if (!kicks.length) {
        ctx.fillStyle = '#ccc';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('No data yet', W / 2, H / 2);
        return;
      }

      // Count per day for last 14 days
      const counts = {};
      kicks.forEach(iso => {
        const dk = dateKey(iso);
        counts[dk] = (counts[dk] || 0) + 1;
      });

      const days = [];
      for (let i = 13; i >= 0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        const dk = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        days.push({ key: dk, count: counts[dk] || 0, label: `${d.getMonth()+1}/${d.getDate()}` });
      }

      const max = Math.max(...days.map(d => d.count), 1);
      const padLeft = 30;
      const padBottom = 28;
      const padTop = 10;
      const barArea = W - padLeft - 10;
      const barW = Math.min(barArea / days.length - 4, 24);
      const gap = (barArea - barW * days.length) / (days.length);
      const chartH = H - padBottom - padTop;

      // Grid lines
      ctx.strokeStyle = '#f0e8e8';
      ctx.lineWidth = 1;
      const gridSteps = Math.min(max, 5);
      for (let i = 0; i <= gridSteps; i++) {
        const y = padTop + chartH - (i / gridSteps) * chartH;
        ctx.beginPath();
        ctx.moveTo(padLeft, y);
        ctx.lineTo(W - 10, y);
        ctx.stroke();
        ctx.fillStyle = '#bbb';
        ctx.font = '10px sans-serif';
        ctx.textAlign = 'right';
        ctx.fillText(Math.round((i / gridSteps) * max), padLeft - 4, y + 3);
      }

      // Bars
      days.forEach((d, i) => {
        const x = padLeft + i * (barW + gap) + gap / 2;
        const barH = (d.count / max) * chartH;
        const y = padTop + chartH - barH;

        const grad = ctx.createLinearGradient(x, y, x, padTop + chartH);
        grad.addColorStop(0, '#f7a8c4');
        grad.addColorStop(1, '#b35a7a');
        ctx.fillStyle = grad;

        ctx.beginPath();
        const r = Math.min(3, barW / 2);
        if (barH > r) {
          ctx.moveTo(x, y + r);
          ctx.arcTo(x, y, x + r, y, r);
          ctx.arcTo(x + barW, y, x + barW, y + r, r);
          ctx.lineTo(x + barW, padTop + chartH);
          ctx.lineTo(x, padTop + chartH);
        } else if (d.count > 0) {
          ctx.rect(x, y, barW, barH);
        }
        ctx.fill();

        // Count on top
        if (d.count > 0) {
          ctx.fillStyle = '#b35a7a';
          ctx.font = 'bold 10px sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText(d.count, x + barW / 2, y - 3);
        }

        // Day label
        ctx.fillStyle = '#999';
        ctx.font = '9px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(d.label, x + barW / 2, H - 6);
      });
    }

    // Past kick modal
    function openPastKick() {
      const now = new Date();
      document.getElementById('past-date').value = dateKey(now.toISOString());
      const hh = String(now.getHours()).padStart(2, '0');
      const mm = String(now.getMinutes()).padStart(2, '0');
      document.getElementById('past-time').value = `${hh}:${mm}`;
      document.getElementById('past-modal').classList.add('open');
    }

    function closePastKick() {
      document.getElementById('past-modal').classList.remove('open');
    }

    function savePastKick() {
      const d = document.getElementById('past-date').value;
      const t = document.getElementById('past-time').value;
      if (!d || !t) { alert('Please fill in both date and time.'); return; }
      const iso = new Date(`${d}T${t}`).toISOString();
      const kicks = getKicks();
      kicks.push(iso);
      kicks.sort();
      saveKicks(kicks);
      closePastKick();
      render();
    }

    // Close modal on overlay click
    document.getElementById('past-modal').addEventListener('click', function(e) {
      if (e.target === this) closePastKick();
    });

    // Init
    render();
    window.addEventListener('resize', () => render());
  </script>
</body>
</html>
